<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FourDVzla</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='9' cy='21' r='1'></circle><circle cx='20' cy='21' r='1'></circle><path d='M1 1h4l2.68 12.83a2 2 0 0 0 2 1.67h9.23a2 2 0 0 0 2-1.67L23 6H6'></path></svg>" type="image/svg+xml">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Fondo principal oscuro */
            color: #e2e8f0; /* Color de texto principal */
            transition: all 0.3s ease-in-out;
        }

        body.no-scroll {
            overflow: hidden;
        }

        .product-card, .course-card {
            display: flex;
            flex-direction: column;
        }
        .card-img {
            aspect-ratio: 1/1;
            object-fit: cover;
        }
        /* Estilos para ocultar/mostrar las páginas principales */
        .page-container {
            display: none;
        }
        .page-container.active {
            display: block;
        }
        /* Estilos para el overlay del carrito */
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            overflow-y: auto;
        }
        .cart-overlay.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        .cart-overlay-content {
            width: 100%;
            max-width: 900px;
            margin-top: 4rem;
            margin-bottom: 2rem;
        }
        .filter-button.active {
            background-color: #ec4899; /* pink-500 */
            color: #fff;
            box-shadow: 0 4px 6px -1px rgba(236, 72, 153, 0.5), 0 2px 4px -1px rgba(236, 72, 153, 0.5);
            transform: translateY(-2px);
        }
        .button-disabled {
            background-color: #4a5568 !important; /* gray-700 */
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div id="notification-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="notification-message" class="text-gray-200 font-medium"></p>
            <button onclick="document.getElementById('notification-modal').classList.add('hidden')" class="mt-4 px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors">Cerrar</button>
        </div>
    </div>

    <nav class="sticky top-0 z-40 bg-gray-800 shadow-lg rounded-b-xl p-4 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
        <div class="text-2xl font-bold text-pink-500" style="text-shadow: 0 0 5px #ec4899, 0 0 10px #ec4899;">FourDVzla</div>
        <div class="flex items-center space-x-4">
            <button onclick="navigateTo('home-page')" class="text-gray-400 hover:text-pink-500 transition-colors">Inicio</button>
            <button onclick="navigateTo('catalog-page')" class="text-gray-400 hover:text-pink-500 transition-colors">Catálogo</button>
            <button onclick="showCart()" class="text-gray-400 hover:text-pink-500 transition-colors flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.182 1.953.945 2.572L15 21h-2a2 2 0 01-2-2v-2a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2z" />
                </svg>
                <span id="cart-count" class="ml-1 text-xs font-bold bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center">0</span>
            </button>
        </div>
    </nav>

    <div id="main-content">
        <div id="home-page" class="page-container active">
            <main class="container mx-auto px-4 py-16">
                <section class="mt-8 relative rounded-xl overflow-hidden shadow-xl p-8 bg-gray-800">
                    <div class="relative z-10 flex flex-col items-center justify-center text-center">
                        <h2 class="text-4xl md:text-6xl font-extrabold tracking-tight text-white mb-2">
                            Da vida a tu creatividad
                        </h2>
                        <div class="text-lg md:text-xl font-medium text-white max-w-2xl mx-auto">
                            <p class="mb-4">
                                En FourDVzla, convertimos la masa flexible en arte. Somos un emprendimiento venezolano dedicado a ofrecerte productos únicos y de alta calidad, hechos a mano con amor y dedicación.
                            </p>
                            <p class="font-extrabold text-pink-500" style="text-shadow: 0 0 5px #ec4899, 0 0 10px #ec4899;">
                                ¡Y te invitamos a unirte a nuestra comunidad de creadores a través de nuestros cursos!
                            </p>
                        </div>
                    </div>
                </section>

                <section class="mt-16">
                    <h2 class="text-3xl font-bold text-gray-100 text-center">Productos Destacados</h2>
                    <div id="featured-products-container" class="mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                        </div>
                </section>
            </main>
        </div>

        <div id="catalog-page" class="page-container">
            <main class="container mx-auto p-4">
                 <aside class="mb-8 bg-gray-800 rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-100 mb-4">Filtrar por</h3>
                    <div class="flex flex-wrap gap-2 sm:gap-4">
                        <button id="filter-all" onclick="filterCatalog('all', this)" class="filter-button active flex-1 py-2 px-4 bg-gray-700 text-gray-200 rounded-lg font-semibold transition-colors hover:bg-pink-500 hover:text-white">Todos</button>
                        <button id="filter-products" onclick="filterCatalog('producto', this)" class="filter-button flex-1 py-2 px-4 bg-gray-700 text-gray-200 rounded-lg font-semibold transition-colors hover:bg-pink-500 hover:text-white">Productos</button>
                        <button id="filter-courses" onclick="filterCatalog('curso', this)" class="filter-button flex-1 py-2 px-4 bg-gray-700 text-gray-200 rounded-lg font-semibold transition-colors hover:bg-pink-500 hover:text-white">Cursos</button>
                    </div>
                </aside>

                <section class="w-full">
                    <div id="catalog-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                        </div>
                </section>
            </main>
        </div>
    </div>

    <div id="cart-page" class="cart-overlay hidden">
        <div class="cart-overlay-content p-4 lg:p-8">
            <header class="bg-gray-800 shadow-md p-4 sticky top-0 z-40 rounded-t-xl flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-100">Tu Carrito de Compras</h1>
                <button onclick="hideCart()" class="text-gray-400 hover:text-pink-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </header>
            <main class="bg-gray-800 rounded-b-xl shadow-md p-6">
                <div class="flex flex-col lg:flex-row lg:space-x-8">
                    <div class="w-full lg:w-2/3">
                        <div id="cart-items-list" class="space-y-6">
                            </div>
                    </div>

                    <div class="w-full lg:w-1/3 p-6 bg-gray-900 rounded-xl mt-6 lg:mt-0">
                        <h2 class="text-2xl font-bold text-gray-100 mb-4">Resumen del Pedido</h2>
                        <div class="flex justify-between items-center text-gray-400 mb-2">
                            <span>Subtotal:</span>
                            <span id="cart-subtotal" class="font-medium text-gray-200">$0.00</span>
                        </div>
                        <div class="mt-4 text-center text-gray-400 text-sm italic">
                            El costo de envío se coordina al momento de que el vendedor contacte con usted (Si es solo curso su selección, no aplica esto)
                        </div>
                        <div class="border-t border-gray-700 pt-4 flex justify-between items-center font-bold text-gray-100">
                            <span>Total:</span>
                            <span id="cart-total" class="text-2xl text-pink-500">$0.00</span>
                        </div>
                        <button id="checkout-button" onclick="showCheckout()" class="mt-6 w-full py-3 text-white font-bold rounded-lg shadow-lg transition-colors">
                            Pagar
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="checkout-page" class="cart-overlay hidden">
        <div class="cart-overlay-content p-4 lg:p-8">
            <div class="max-w-lg mx-auto w-full">
                <header class="bg-gray-800 shadow-md p-4 sticky top-0 z-40 rounded-t-xl flex justify-between items-center">
                    <button onclick="hideCheckout()" class="text-pink-500 font-bold text-lg hover:text-pink-600 transition-colors flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Volver al carrito
                    </button>
                    <h1 class="text-2xl font-bold text-gray-100">Información de Envío</h1>
                </header>
                <main class="bg-gray-800 rounded-b-xl shadow-md p-6">
                    <form id="checkout-form" class="space-y-4">
                        <div>
                            <label for="name" class="block text-gray-400 font-semibold mb-1">Nombre y Apellido</label>
                            <input type="text" id="name" name="name" class="w-full p-2 bg-gray-700 text-gray-100 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <p id="name-error" class="text-red-500 text-sm mt-1 hidden">Este campo es obligatorio.</p>
                        </div>
                        <div>
                            <label for="phone" class="block text-gray-400 font-semibold mb-1">Teléfono de contacto (WhatsApp)</label>
                            <input type="tel" id="phone" name="phone" class="w-full p-2 bg-gray-700 text-gray-100 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <p id="phone-error" class="text-red-500 text-sm mt-1 hidden">Este campo es obligatorio.</p>
                        </div>
                        <div>
                            <label for="address" class="block text-gray-400 font-semibold mb-1">Dirección</label>
                            <textarea id="address" name="address" rows="3" class="w-full p-2 bg-gray-700 text-gray-100 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"></textarea>
                            <p id="address-error" class="text-red-500 text-sm mt-1 hidden">Este campo es obligatorio.</p>
                        </div>
                        <button type="submit" class="w-full py-3 bg-pink-500 text-white font-bold rounded-lg shadow-lg hover:bg-pink-600 transition-colors">
                            Confirmar Compra
                        </button>
                    </form>
                </main>
            </div>
        </div>
    </div>

    <div id="whatsapp-modal" class="cart-overlay hidden">
        <main class="flex flex-col items-center justify-center min-h-screen p-4 text-center">
            <div class="bg-gray-800 rounded-xl shadow-xl p-8 max-w-sm w-full">
                <h1 class="text-3xl font-bold text-pink-500 mb-4">¡Solo falta un último pasó!</h1>
                <p class="text-gray-300">
                    Por favor, proceda a WhatsApp y envíe los detalles de tu pedido para que podamos gestionarlo.
                </p>
                <button onclick="sendWhatsAppMessage()" class="mt-6 w-full py-3 bg-pink-500 text-white font-bold rounded-lg hover:bg-pink-600 transition-colors">
                    Enviar Pedido a WhatsApp
                </button>
                <button onclick="hideWhatsAppModal()" class="mt-2 text-sm text-gray-400 hover:text-gray-200 transition-colors">
                    Volver
                </button>
            </div>
        </main>
    </div>

    <div id="confirmation-page" class="cart-overlay hidden">
        <main class="flex flex-col items-center justify-center min-h-screen p-4 text-center">
            <div class="bg-gray-800 rounded-xl shadow-xl p-8 max-w-md w-full">
                <h1 class="text-4xl font-extrabold text-pink-500 mb-4">¡Compra confirmada!</h1>
                <p class="text-lg text-gray-400">¡Gracias por tu compra en FourDVzla! Tu pedido ha sido procesado con éxito. Nos comunicaremos contigo para coordinar la entrega.</p>
                <button onclick="hideConfirmation()" class="mt-8 px-6 py-3 bg-pink-500 text-white font-bold rounded-lg hover:bg-pink-600 transition-colors">
                    Volver al Inicio
                </button>
            </div>
        </main>
    </div>

    <footer class="bg-gray-800 text-gray-400 text-center text-sm py-4 mt-16 rounded-t-xl shadow-inner">
        <p>© 2025 FourDVzla. Todos los derechos reservados.</p>
    </footer>

    <script>
        // Datos de productos y cursos
        const products = [
            { id: 1, name: "Kuromi", price: 20.50, category: "producto", type: "llavero", featured: true, image: 'https://i.ibb.co/pvh19LMt/Kuromi.png', stock: 100 },
            { id: 2, name: "Goku", price: 10.50, category: "producto", type: "llavero", featured: true, image: 'https://i.ibb.co/KjGS3YcY/Goku.png', stock: 100 },
            { id: 3, name: "Stitch", price: 25.00, category: "producto", type: "figura", featured: true, image: 'https://i.ibb.co/NdvR2PV2/Stitch.png', stock: 100 },
            { id: 4, name: "Curso Básico: Figuras", price: 35.00, category: "curso", type: "curso", featured: true, image: 'https://i.ibb.co/tTzPb6GK/Curso-Basico.png' },
            { id: 5, name: "Accesorio para Celular", price: 12.00, category: "producto", type: "accesorio", featured: false, image: 'https://placehold.co/400x400/1f2937/dbeafe?text=Accesorio+Movil', stock: 0 },
            { id: 6, name: "Curso Avanzado: Llaveros", price: 40.00, category: "curso", type: "curso", featured: false, image: 'https://placehold.co/400x400/1f2937/c7d2fe?text=Curso+Avanzado', stock: 0 },
        ];

        // Estado de la aplicación
        let cart = JSON.parse(localStorage.getItem('fourdvzla_cart')) || [];
        let currentPage = 'home-page';
        let whatsappUrl = ''; // Variable para almacenar la URL de WhatsApp
        let activeFilter = 'all'; // Nueva variable para controlar el filtro activo

        // Función para mostrar mensajes de notificación
        function showNotification(message) {
            const modal = document.getElementById('notification-modal');
            const msgEl = document.getElementById('notification-message');
            msgEl.textContent = message;
            modal.classList.remove('hidden');
        }

        // --- Funciones de Renderizado ---
        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = count;
        }

        function renderHomePage() {
            const container = document.getElementById('featured-products-container');
            container.innerHTML = '';
            const featuredProducts = products.filter(p => p.featured).slice(0, 4);
            featuredProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'bg-gray-800 rounded-xl shadow-md overflow-hidden transition-all hover:scale-105 flex flex-col';
                card.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover card-img">
                    <div class="p-4 text-center flex-grow flex flex-col justify-between">
                        <div>
                            <h3 class="font-bold text-gray-100 text-lg">${product.name}</h3>
                            <p class="text-pink-500 font-semibold mt-1">$${product.price.toFixed(2)}</p>
                        </div>
                        <button onclick="navigateTo('catalog-page')" class="mt-4 w-full py-2 bg-pink-500 text-white font-semibold rounded-lg hover:bg-pink-600 transition-colors">Ir al catalogo</button>
                    </div>
                `;
                container.appendChild(card);
            });
            updateCartCount();
        }

        function renderCatalogPage() {
            const container = document.getElementById('catalog-grid');
            container.innerHTML = '';

            const filteredProducts = products.filter(p => {
                if (activeFilter === 'all') {
                    // Si el filtro es 'all', muestra todos los artículos.
                    return true;
                }
                // Si el filtro es 'producto' o 'curso', filtra por categoría Y por stock.
                // Verifica si el artículo tiene la propiedad 'stock' y si es mayor a 0.
                // Si no tiene la propiedad 'stock' (como los cursos), se asume que siempre hay stock.
                return p.category === activeFilter && (!('stock' in p) || p.stock > 0);
            });

            filteredProducts.forEach(product => {
                const isCourse = product.category === 'curso';
                const hasStock = 'stock' in product;
                const isOutOfStock = hasStock && product.stock <= 0;

                const buttonText = isCourse ? 'Inscribirse' : (isOutOfStock ? 'Agotado' : 'Añadir al carrito');
                const buttonClass = isOutOfStock ? 'button-disabled' : (isCourse ? 'bg-indigo-500 hover:bg-indigo-600' : 'bg-pink-500 hover:bg-pink-600');

                const stockDisplay = hasStock ? `<p class="text-sm text-gray-400 mt-2">Stock: ${product.stock}</p>` : '';

                const card = document.createElement('div');
                card.className = 'bg-gray-800 rounded-xl shadow-md overflow-hidden transition-all hover:scale-105 flex flex-col';
                card.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover card-img">
                    <div class="p-4 text-center flex-grow flex flex-col justify-between">
                        <div>
                            <h3 class="font-bold text-gray-100 text-lg">${product.name}</h3>
                            <p class="text-pink-500 font-semibold mt-1">$${product.price.toFixed(2)}</p>
                            ${stockDisplay}
                        </div>
                        <button onclick="addToCart(${product.id})" class="mt-4 w-full py-2 ${buttonClass} text-white font-semibold rounded-lg transition-colors" ${isOutOfStock ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
            updateCartCount();
        }

        function renderCartPage() {
            const container = document.getElementById('cart-items-list');
            const subtotalEl = document.getElementById('cart-subtotal');
            const totalEl = document.getElementById('cart-total');
            const checkoutButton = document.getElementById('checkout-button');
            container.innerHTML = '';
            let subtotal = 0;

            if (cart.length === 0) {
                container.innerHTML = `<p class="text-center text-gray-500">Tu carrito está vacío.</p>`;
                // Deshabilitar y estilizar el botón de pago
                checkoutButton.disabled = true;
                checkoutButton.classList.remove('bg-pink-500', 'hover:bg-pink-600');
                checkoutButton.classList.add('bg-gray-600', 'cursor-not-allowed');
                checkoutButton.textContent = 'Tu carrito está vacío';
            } else {
                cart.forEach(item => {
                    subtotal += item.price * item.quantity;
                    const itemEl = document.createElement('div');
                    itemEl.className = 'flex items-center space-x-4 p-4 border border-gray-700 rounded-xl';
                    itemEl.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="w-16 h-16 rounded-md object-cover">
                        <div class="flex-grow">
                            <h4 class="font-semibold text-gray-100">${item.name}</h4>
                            <p class="text-sm text-gray-400">$${item.price.toFixed(2)} c/u</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateQuantity(${item.id}, -1)" class="w-8 h-8 rounded-full bg-gray-700 text-gray-400 flex items-center justify-center font-bold">-</button>
                            <span class="text-gray-200">${item.quantity}</span>
                            <button onclick="updateQuantity(${item.id}, 1)" class="w-8 h-8 rounded-full bg-gray-700 text-gray-400 flex items-center justify-center font-bold">+</button>
                        </div>
                        <div class="font-bold text-gray-100">$${(item.price * item.quantity).toFixed(2)}</div>
                    `;
                    container.appendChild(itemEl);
                });
                // Habilitar y estilizar el botón de pago
                checkoutButton.disabled = false;
                checkoutButton.classList.remove('bg-gray-600', 'cursor-not-allowed');
                checkoutButton.classList.add('bg-pink-500', 'hover:bg-pink-600');
                checkoutButton.textContent = 'Pagar';
            }

            subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
            totalEl.textContent = `$${subtotal.toFixed(2)}`;
            updateCartCount();
        }

        // --- Lógica del Carrito con inventario ---
        function addToCart(productId) {
            // Se busca el producto en la fuente de datos (products)
            const product = products.find(p => p.id === productId);
            if (!product) return;

            // Se verifica si hay stock antes de añadir al carrito
            if (!('stock' in product) || product.stock > 0) {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }

                // Se decrementa el stock del producto si es un producto físico
                if ('stock' in product) {
                    product.stock--;
                }

                localStorage.setItem('fourdvzla_cart', JSON.stringify(cart));
                updateCartCount();
                showNotification(`${product.name} ha sido añadido al carrito.`);

                // Llama a la función de renderizado sin pasar un parámetro para que use el filtro activo
                renderCatalogPage();

            } else {
                showNotification(`¡Lo sentimos! ${product.name} está agotado.`);
            }
        }

        function updateQuantity(productId, change) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            const product = products.find(p => p.id === productId);

            if (itemIndex > -1 && product) {
                if (change === 1) {
                    if (!('stock' in product) || product.stock > 0) {
                        cart[itemIndex].quantity += 1;
                        if ('stock' in product) {
                            product.stock -= 1;
                        }
                    } else {
                        showNotification(`No hay más stock disponible de ${product.name}.`);
                        return;
                    }
                } else if (change === -1) {
                    cart[itemIndex].quantity -= 1;
                    if ('stock' in product) {
                        product.stock += 1;
                    }
                    if (cart[itemIndex].quantity <= 0) {
                        cart.splice(itemIndex, 1);
                    }
                }

                localStorage.setItem('fourdvzla_cart', JSON.stringify(cart));
                renderCartPage();
                // Llama a la función de renderizado para actualizar el stock
                renderCatalogPage();
            }
        }

        // --- Navegación entre páginas principales ---
        function navigateTo(pageId) {
            document.querySelectorAll('.page-container').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;

            // Renderizar el contenido de la página si es necesario
            if (pageId === 'home-page') {
                renderHomePage();
            } else if (pageId === 'catalog-page') {
                // Navega al catálogo y renderiza con el filtro 'all' por defecto
                const allButton = document.getElementById('filter-all');
                if (allButton) {
                    filterCatalog('all', allButton);
                }
            }
            window.scrollTo(0, 0); // Volver al inicio de la página
        }

        // --- Funciones para los overlays (carrito, checkout, confirmación) ---
        function showCart() {
            renderCartPage();
            document.getElementById('cart-page').classList.add('active');
            document.body.classList.add('no-scroll');
        }

        function hideCart() {
            document.getElementById('cart-page').classList.remove('active');
            document.body.classList.remove('no-scroll');
        }

        function showCheckout() {
            if (cart.length === 0) {
                showNotification("El carrito está vacío. Añade productos para continuar.");
                return;
            }
            document.getElementById('cart-page').classList.remove('active');
            document.getElementById('checkout-page').classList.add('active');
        }

        function hideCheckout() {
            document.getElementById('checkout-page').classList.remove('active');
            showCart(); // Esta función ya añade la clase 'no-scroll'
        }

        function showWhatsAppModal() {
            document.getElementById('whatsapp-modal').classList.add('active');
        }

        function hideWhatsAppModal() {
            document.getElementById('whatsapp-modal').classList.remove('active');
            showCheckout();
        }

        function showConfirmation() {
            document.getElementById('whatsapp-modal').classList.remove('active');
            document.getElementById('checkout-page').classList.remove('active');
            document.getElementById('confirmation-page').classList.add('active');
        }

        function hideConfirmation() {
            document.getElementById('confirmation-page').classList.remove('active');
            navigateTo('home-page');
            document.body.classList.remove('no-scroll');
        }

        // --- Lógica de Filtrado---
        function filterCatalog(category, clickedButton) {
            // Elimina la clase 'active' de todos los botones de filtro
            document.querySelectorAll('.filter-button').forEach(button => {
                button.classList.remove('active');
            });
            // Añade la clase 'active' al botón clickeado
            clickedButton.classList.add('active');

            activeFilter = category;
            renderCatalogPage();
        }

        function sendWhatsAppMessage() {
            if (whatsappUrl) {
                window.open(whatsappUrl, '_blank');
                // Se limpia el carrito y el localStorage después de enviar el pedido
                cart = [];
                localStorage.removeItem('fourdvzla_cart');
                updateCartCount();
                showConfirmation();
            }
        }

        // --- Lógica del Formulario de Checkout ---
        document.getElementById('checkout-form').addEventListener('submit', function(event) {
            event.preventDefault();
            let isValid = true;
            const formElements = ['name', 'phone', 'address'];

            formElements.forEach(id => {
                const input = document.getElementById(id);
                const error = document.getElementById(id + '-error');
                if (input.value.trim() === '') {
                    error.classList.remove('hidden');
                    input.classList.add('border-red-500');
                    isValid = false;
                } else {
                    error.classList.add('hidden');
                    input.classList.remove('border-red-500');
                }
            });

            if (isValid) {
                // Obtener los datos del formulario
                const name = document.getElementById('name').value;
                const phone = document.getElementById('phone').value;
                const address = document.getElementById('address').value;

                // Construir el mensaje para WhatsApp
                let message = `¡Nuevo pedido de FourDVzla!\n\n`;
                message += `*Cliente*: ${name}\n`;
                message += `*Teléfono*: ${phone}\n`;
                message += `*Dirección*: ${address}\n\n`;
                message += `*Detalles del pedido*:\n`;

                let total = 0;
                cart.forEach(item => {
                    message += `- ${item.name} (${item.quantity} und.) - $${(item.price * item.quantity).toFixed(2)}\n`;
                    total += item.price * item.quantity;
                });

                message += `\n*Total*: $${total.toFixed(2)}`;

                // Número de WhatsApp al que se enviará el mensaje
                const whatsappNumber = "584142406166";
                whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

                // Ocultar la página de checkout y mostrar el nuevo modal de WhatsApp
                document.getElementById('checkout-page').classList.remove('active');
                showWhatsAppModal();
            }
        });

        // --- Inicialización al cargar la página ---
        window.onload = function() {
            renderHomePage();
            // Llama a navigateTo para renderizar el catálogo con el filtro "Todos" activado por defecto
            navigateTo('home-page');
        };
    </script>
</body>
</html>



